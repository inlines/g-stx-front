<ng-container *ngIf="(productProperties$ | async) as productProperties else loading">
  <div class="row g-4">
    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
      <div class="card bg-dark text-white border-0 shadow rounded-4 overflow-hidden">
        <ng-container *ngIf="productProperties.product.image_url; else noImage">
          <img
            class="w-100"
            [src]="productProperties.product.image_url"
            [alt]="productProperties.product.name"
            style="object-fit: cover;"
            (error)="productProperties.product.image_url = null"
          />
        </ng-container>

        <ng-template #noImage>
          <div class="d-flex justify-content-center align-items-center bg-secondary-subtle" style="height: 300px;">
            <div class="text-muted text-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor"
                  class="bi bi-image mb-2" viewBox="0 0 16 16">
                <path d="M14.002 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2.002a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h12zM2.002 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H2.002z"/>
                <path d="M10.648 8.646a.5.5 0 0 1 .704 0l2.25 2.25V12H2.398v-.316l3.85-3.85a.5.5 0 0 1 .704 0l2.15 2.15 1.546-1.548z"/>
              </svg>
              <div>Нет изображения</div>
            </div>
          </div>
        </ng-template>

        <div class="p-4">
          <h2 class="text-warning mb-3">{{ productProperties.product.name }}</h2>
          <p class="text-light small fst-italic">
            впервые выпущена:
            <ng-container *ngIf="productProperties.product.first_release_date; else never">
              {{ productProperties.product.first_release_date | date:'dd.MM.yy':'UTC' }}
            </ng-container>
            <ng-template #never>никогда</ng-template>
          </p>
        </div>
      </div>
    </div>


    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
      <div class="card bg-dark text-white shadow rounded-4 p-4 h-100">
        <h3 class="text-info mb-3">Релизы игры:</h3>
        <ul class="list-group list-group-flush">
          <li *ngFor="let release of (releases$ | async)" class="list-group-item bg-dark text-white border-secondary">
            <div class="row align-items-center">
              <div class="col" [class.text-decoration-line-through]="release.release_status === 5  || !release.release_date">
                <span class="fw-semibold">{{ release.release_date | date:'dd.MM.yy':'UTC' }}</span>
                на <span class="text-warning">{{ release.platform_name }}</span>
                [{{ release.release_region }}]
              </div>
              <ng-container *ngIf="isAuthorised$ | async">
                <div class="col-auto">
                  <button type="button" [disabled]="release.owned || release.release_status === 5  || !release.release_date"
                    class="btn btn-outline-success btn-sm me-2"
                    (click)="addToCollection(release.release_id)">
                    {{ release.owned ? 'Уже есть' : 'В коллекцию' }}
                  </button>
                  <button type="button" [disabled]="release.wished || release.release_status === 5 || !release.release_date"
                    class="btn btn-outline-primary btn-sm"
                    (click)="addWish(release.release_id)">
                    {{ release.wished ? 'Уже есть' : 'В вишлист' }}
                  </button>
                </div>
              </ng-container>
            </div>
          </li>
        </ul>
      </div>
    </div>

    <div class="col-12">
      <div class="card bg-dark text-white shadow rounded-4 p-4">
        <p class="text-light">{{ productProperties.product.summary || 'У нас нет описания этой игры' }}</p>
      </div>
    </div>

    <div class="col-12" *ngIf="productProperties.screenshots?.length">
      <div class="card bg-dark border-0 shadow rounded-4 p-3">
        <ngb-carousel [interval]="3000" [pauseOnHover]="true" [wrap]="true">
          <ng-template ngbSlide *ngFor="let screen of productProperties.screenshots">
            <img class="d-block w-100 rounded-3" [src]="screen" style="object-fit: cover; max-height: 500px;" />
          </ng-template>
        </ngb-carousel>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #loading>
  <div class="row">
    <div class="col text-center py-5">
      <div class="spinner-border text-primary" role="status"></div>
      <h4 class="mt-3">Загрузка...</h4>
    </div>
  </div>
</ng-template>
